<div style="margin-bottom: 15px;">
  <a href="/demo/all_use_cases" style="color: #3498db; text-decoration: none;">‚Üê Back to All Use Cases</a>
</div>

<div class="card">
  <h2>Devise + CanCanCan Adapter Example</h2>
  <p>This example demonstrates how to integrate DecisionAgent with Devise authentication and CanCanCan authorization.</p>
  <p>The example simulates CanCanCan abilities that use DecisionAgent rules for authorization decisions.</p>

  <div style="background: #e8f8f5; padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid #16a085;">
    <strong>üí° How to Test:</strong> Click the button below to run a simulation that demonstrates how CanCanCan abilities use DecisionAgent rules to make authorization decisions.
  </div>

  <%= form_with url: demo_devise_cancancan_adapter_path, method: :post, local: true do |f| %>
    <button type="submit" style="background: #16a085; padding: 12px 30px; font-size: 16px; font-weight: bold;">üß™ Run Devise + CanCanCan Adapter Simulation</button>
  <% end %>

  <% if @results %>
    <div class="result" style="margin-top: 20px;">
      <h3>Simulation Results</h3>
      <p>The following table shows how CanCanCan abilities use DecisionAgent rules to make authorization decisions:</p>
      
      <table class="table" style="width: 100%; border-collapse: collapse; margin-top: 15px;">
        <thead>
          <tr style="background: #f8f9fa; border-bottom: 2px solid #dee2e6;">
            <th style="padding: 12px; text-align: left;">User</th>
            <th style="padding: 12px; text-align: left;">Role</th>
            <th style="padding: 12px; text-align: left;">Action</th>
            <th style="padding: 12px; text-align: left;">Resource</th>
            <th style="padding: 12px; text-align: left;">Can?</th>
            <th style="padding: 12px; text-align: left;">Details</th>
          </tr>
        </thead>
        <tbody>
          <% @results.each do |result| %>
            <tr style="border-bottom: 1px solid #dee2e6;">
              <td style="padding: 12px;"><%= result[:user] %></td>
              <td style="padding: 12px;"><span class="badge"><%= result[:role] %></span></td>
              <td style="padding: 12px;"><%= result[:action] %></td>
              <td style="padding: 12px;"><%= result[:resource] %></td>
              <td style="padding: 12px;">
                <span class="badge <%= result[:can] ? 'success' : 'error' %>">
                  <%= result[:can] ? '‚úì Yes' : '‚úó No' %>
                </span>
              </td>
              <td style="padding: 12px;">
                <% if result[:same_organization] %>
                  <small>Same org</small>
                <% end %>
                <% if result[:is_author] %>
                  <small>Author</small>
                <% end %>
                <% if result[:published] %>
                  <small>Published</small>
                <% end %>
                <% if result[:confirmed] == false %>
                  <small style="color: red;">Unconfirmed</small>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% end %>
</div>

<div class="card" style="background: #f8f9fa;">
  <h3>How It Works</h3>
  <ul>
    <li><strong>Devise Users:</strong> The example includes a <code>DeviseUser</code> class with authentication attributes (confirmed, etc.)</li>
    <li><strong>CanCanCan Abilities:</strong> The <code>Ability</code> class uses DecisionAgent rules to determine permissions</li>
    <li><strong>Authorization Checks:</strong> Methods like <code>can?</code> and <code>cannot?</code> call DecisionAgent to evaluate permissions</li>
    <li><strong>Context Building:</strong> User and resource attributes are mapped to DecisionAgent context</li>
  </ul>
  
  <h4 style="margin-top: 15px;">Key Features:</h4>
  <ul>
    <li>Admins can perform all actions on all resources (if confirmed)</li>
    <li>Managers can read, create, and update resources in their organization</li>
    <li>Users can manage their own resources</li>
    <li>Users can read published resources</li>
    <li>Unconfirmed users are denied all actions</li>
  </ul>
</div>

